generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("LOCAL_DB_URL")
}

model User {
  id          Int            @id @default(autoincrement())
  username    String         @unique
  otp         Int?
  otpExpireAt DateTime?
  avatar      Bytes?
  address     String?
  phoneNumber String         @unique
  randomInt   Int            @default(0)
  gender      Gender?
  orders      Order[]
  seller      Seller?
  teamMembers TeamMember[]
  followers   Relationship[] @relation("follower")
  followings  Relationship[] @relation("following")
  createdAt   DateTime       @default(dbgenerated("NOW()"))
  updatedAt   DateTime       @updatedAt
  Review      Review[]
}

model Seller {
  id            Int          @id
  brandName     String
  active        Boolean      @default(false)
  bio           String
  contactNumber String
  email         String
  storeAddress  String
  type          String
  categoryId    Int
  products      Product[]
  category      Category     @relation(fields: [categoryId], references: [id])
  user          User         @relation(fields: [id], references: [id])
  createdAt     DateTime     @default(dbgenerated("NOW()"))
  updatedAt     DateTime     @updatedAt
  LiveStream    LiveStream[]
}

model Relationship {
  id          Int      @id @default(autoincrement())
  followerId  Int
  followingId Int
  follower    User     @relation("follower", fields: [followerId], references: [id])
  following   User     @relation("following", fields: [followingId], references: [id])
  createdAt   DateTime @default(dbgenerated("NOW()"))
  updatedAt   DateTime @updatedAt

  @@unique([followerId, followingId])
}

model Category {
  id           Int      @id @default(autoincrement())
  categoryName String
  createdAt    DateTime @default(dbgenerated("NOW()"))
  updatedAt    DateTime @updatedAt
  Seller       Seller[]
}

model Product {
  id            Int      @id @default(autoincrement())
  name          String
  description   String?
  price         Float
  stockQuantity Int
  imageLink     String?
  teamPrice     Float
  teamSize      Int
  sellerId      Int
  teams         Team[]
  orders        Order[]
  reviews       Review[]
  seller        Seller   @relation(fields: [sellerId], references: [id])
  createdAt     DateTime @default(dbgenerated("NOW()"))
  updatedAt     DateTime @updatedAt
}

model Review {
  id          Int      @id @default(autoincrement())
  productId   Int
  orderId     Int      @unique
  userId      Int
  rating      Float
  description String?
  order       Order    @relation(fields: [orderId], references: [id])
  product     Product  @relation(fields: [productId], references: [id])
  user        User     @relation(fields: [userId], references: [id])
  createdAt   DateTime @default(dbgenerated("NOW()"))
  updatedAt   DateTime @updatedAt
}

model Team {
  id          Int          @id @default(autoincrement())
  description String?
  code        String?
  teamLink    String?
  expireAt    DateTime     @default(dbgenerated("(now() + '30 minutes'::interval minute)"))
  productId   Int?
  teamStatus  TeamStatus   @default(teamCreated)
  teamMembers TeamMember[]
  Product     Product?     @relation(fields: [productId], references: [id])
  Order       Order[]
  createdAt   DateTime     @default(dbgenerated("NOW()"))
  updatedAt   DateTime     @updatedAt
}

model TeamMember {
  id        Int      @id @default(autoincrement())
  teamId    Int
  userId    Int
  team      Team     @relation(fields: [teamId], references: [id])
  user      User     @relation(fields: [userId], references: [id])
  createdAt DateTime @default(dbgenerated("NOW()"))
  updatedAt DateTime @updatedAt

  @@unique([teamId, userId])
}

model Order {
  id           Int          @id @default(autoincrement())
  userId       Int
  productId    Int?
  quantity     Int          @default(1)
  totalPrice   Float
  teamId       Int?
  purchaseType PurchaseType @default(team)
  orderStatus  OrderStatus  @default(orderPlaced)
  team         Team?        @relation(fields: [teamId], references: [id])
  user         User         @relation(fields: [userId], references: [id])
  Product      Product?     @relation(fields: [productId], references: [id])
  review       Review?
  createdAt    DateTime     @default(dbgenerated("NOW()"))
  updatedAt    DateTime     @updatedAt
}

model LiveStream {
  id          Int      @id @default(autoincrement())
  meetId      String
  description String?
  thumbnail   String?
  sellerId    Int
  expiresAt   DateTime @default(dbgenerated("(now() + '60 minutes'::interval minute)"))
  createdAt   DateTime @default(dbgenerated("NOW()"))
  updatedAt   DateTime @updatedAt
  Seller      Seller   @relation(fields: [sellerId], references: [id])
}

enum Gender {
  MALE
  FEMALE
  OTHERS
}

enum TeamStatus {
  teamCreated
  teamConfirmed
  teamExpired
}

enum PurchaseType {
  individual
  team
}

enum OrderStatus {
  orderPlaced
  orderConfirmed
  productShipped
  productDelivered
  orderExpired
}
